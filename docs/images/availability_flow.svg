<?xml version="1.0" encoding="UTF-8"?>
<svg xmlns="http://www.w3.org/2000/svg" width="1100" height="720" viewBox="0 0 1100 720">
  <defs>
    <style><![CDATA[
      .title { font: 700 22px/1.2 system-ui, -apple-system, Segoe UI, Roboto, Ubuntu, Cantarell, 'Helvetica Neue', Arial, sans-serif; fill: #111827; }
      .label { font: 600 14px/1.3 system-ui; fill: #1f2937; }
      .small { font: 500 12px/1.4 system-ui; fill: #374151; }
      .lane { fill: #ffffff; stroke: #bbf7d0; stroke-width: 2; rx: 10; }
      .bg { fill: #f0fdf4; }
      .arrow { stroke: #16a34a; stroke-width: 2; marker-end: url(#arrowhead); }
      .box { fill: #dcfce7; stroke: #86efac; rx: 6; }
      .note { fill: #ecfeff; stroke: #67e8f9; rx: 6; }
    ]]></style>
    <marker id="arrowhead" markerWidth="8" markerHeight="8" refX="6" refY="3" orient="auto">
      <polygon points="0 0, 6 3, 0 6" fill="#16a34a" />
    </marker>
  </defs>
  <rect class="bg" x="0" y="0" width="1100" height="720"/>
  <text class="title" x="30" y="40">Availability Management Flow – Tutor</text>

  <rect class="lane" x="30" y="70" width="320" height="620"/>
  <text class="label" x="50" y="95">Frontend (Tutor)</text>

  <rect class="lane" x="390" y="70" width="320" height="620"/>
  <text class="label" x="410" y="95">API (Express)</text>

  <rect class="lane" x="750" y="70" width="320" height="620"/>
  <text class="label" x="770" y="95">Database (MongoDB)</text>

  <!-- List slots -->
  <rect class="box" x="50" y="130" width="280" height="60"/>
  <text class="small" x="60" y="155">1) GET /api/availability/my/slots</text>
  <line class="arrow" x1="330" y1="160" x2="390" y2="160"/>
  <rect class="note" x="410" y="130" width="280" height="60"/>
  <text class="small" x="420" y="155">protect+authorize('tutor')</text>
  <line class="arrow" x1="690" y1="160" x2="750" y2="160"/>
  <rect class="note" x="770" y="130" width="280" height="60"/>
  <text class="small" x="780" y="155">find({ tutor: me }) sort by day/time</text>

  <!-- Create slot -->
  <rect class="box" x="50" y="220" width="280" height="60"/>
  <text class="small" x="60" y="245">2) POST /api/availability</text>
  <line class="arrow" x1="330" y1="250" x2="390" y2="250"/>
  <rect class="note" x="410" y="220" width="280" height="60"/>
  <text class="small" x="420" y="245">Validate required fields, duplicates</text>
  <line class="arrow" x1="690" y1="250" x2="750" y2="250"/>
  <rect class="note" x="770" y="220" width="280" height="60"/>
  <text class="small" x="780" y="245">Insert slot; index on tutor/day</text>

  <!-- Update slot -->
  <rect class="box" x="50" y="310" width="280" height="60"/>
  <text class="small" x="60" y="335">3) PUT /api/availability/:id</text>
  <line class="arrow" x1="330" y1="340" x2="390" y2="340"/>
  <rect class="note" x="410" y="310" width="280" height="60"/>
  <text class="small" x="420" y="335">Ownership check (tutor matches)</text>
  <line class="arrow" x1="690" y1="340" x2="750" y2="340"/>
  <rect class="note" x="770" y="310" width="280" height="60"/>
  <text class="small" x="780" y="335">updateOne with validators</text>

  <!-- Delete slot -->
  <rect class="box" x="50" y="400" width="280" height="60"/>
  <text class="small" x="60" y="425">4) DELETE /api/availability/:id</text>
  <line class="arrow" x1="330" y1="430" x2="390" y2="430"/>
  <rect class="note" x="410" y="400" width="280" height="60"/>
  <text class="small" x="420" y="425">Ownership check → delete</text>

  <!-- Public slots for date -->
  <rect class="box" x="50" y="490" width="280" height="60"/>
  <text class="small" x="60" y="515">5) GET /api/availability/:tutor/date/:d</text>
  <line class="arrow" x1="330" y1="520" x2="390" y2="520"/>
  <rect class="note" x="410" y="490" width="280" height="60"/>
  <text class="small" x="420" y="515">Combine recurring + specificDate</text>
  <line class="arrow" x1="690" y1="520" x2="750" y2="520"/>
  <rect class="note" x="770" y="490" width="280" height="60"/>
  <text class="small" x="780" y="515">Filter by weekday and date window</text>

  <!-- Notes -->
  <rect class="box" x="410" y="580" width="280" height="80"/>
  <text class="small" x="420" y="605">Edge cases: overlap across slots</text>
  <text class="small" x="420" y="625">Set canonical time format HH:MM</text>
</svg>
