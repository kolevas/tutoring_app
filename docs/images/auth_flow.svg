<?xml version="1.0" encoding="UTF-8"?>
<svg xmlns="http://www.w3.org/2000/svg" width="1100" height="760" viewBox="0 0 1100 760">
  <defs>
    <style><![CDATA[
      .title { font: 700 22px/1.2 system-ui, -apple-system, Segoe UI, Roboto, Ubuntu, Cantarell, 'Helvetica Neue', Arial, sans-serif; fill: #111827; }
      .label { font: 600 14px/1.3 system-ui, -apple-system, Segoe UI, Roboto, Ubuntu, Cantarell, 'Helvetica Neue', Arial, sans-serif; fill: #1f2937; }
      .small { font: 500 12px/1.4 system-ui, -apple-system, Segoe UI, Roboto, Ubuntu, Cantarell, 'Helvetica Neue', Arial, sans-serif; fill: #374151; }
      .lane { fill: #ffffff; stroke: #c7d2fe; stroke-width: 2; rx: 10; }
      .bg { fill: #f8fafc; }
      .arrow { stroke: #2563eb; stroke-width: 2; marker-end: url(#arrowhead); }
      .box { fill: #eff6ff; stroke: #93c5fd; rx: 6; }
      .note { fill: #ecfeff; stroke: #67e8f9; rx: 6; }
      .error { fill: #fee2e2; stroke: #fca5a5; rx: 6; }
    ]]></style>
    <marker id="arrowhead" markerWidth="8" markerHeight="8" refX="6" refY="3" orient="auto">
      <polygon points="0 0, 6 3, 0 6" fill="#2563eb" />
    </marker>
  </defs>
  <rect class="bg" x="0" y="0" width="1100" height="760"/>
  <text class="title" x="30" y="40">Authentication Flow - Register and Login</text>

  <!-- Lanes -->
  <rect class="lane" x="30" y="70" width="320" height="660"/>
  <text class="label" x="50" y="95">Frontend (Browser)</text>

  <rect class="lane" x="390" y="70" width="320" height="660"/>
  <text class="label" x="410" y="95">API (Express)</text>

  <rect class="lane" x="750" y="70" width="320" height="660"/>
  <text class="label" x="770" y="95">Database (MongoDB)</text>

  <!-- Register -->
  <rect class="box" x="50" y="130" width="280" height="60"/>
  <text class="small" x="60" y="155">1) Register (name, email, password)</text>
  <line class="arrow" x1="330" y1="160" x2="390" y2="160"/>
  <rect class="note" x="410" y="130" width="280" height="60"/>
  <text class="small" x="420" y="155">POST /api/auth/register - create student</text>
  <line class="arrow" x1="690" y1="160" x2="750" y2="160"/>
  <rect class="note" x="770" y="130" width="280" height="60"/>
  <text class="small" x="780" y="155">Insert into users (bcrypt hash)</text>

  <rect class="box" x="50" y="210" width="280" height="60"/>
  <text class="small" x="60" y="235">2) Receive JWT + profile</text>
  <line class="arrow" x1="390" y1="240" x2="330" y2="240"/>
  <rect class="note" x="410" y="210" width="280" height="60"/>
  <text class="small" x="420" y="235">Sign token (JWT_SECRET, expires)</text>

  <!-- Login -->
  <rect class="box" x="50" y="300" width="280" height="60"/>
  <text class="small" x="60" y="325">3) Login (identifier + password)</text>
  <line class="arrow" x1="330" y1="330" x2="390" y2="330"/>
  <rect class="note" x="410" y="300" width="280" height="60"/>
  <text class="small" x="420" y="325">identifier: email for admin; index for student/tutor</text>
  <line class="arrow" x1="690" y1="330" x2="750" y2="330"/>
  <rect class="note" x="770" y="300" width="280" height="60"/>
  <text class="small" x="780" y="325">find user; compare bcrypt(password)</text>

  <rect class="box" x="50" y="390" width="280" height="60"/>
  <text class="small" x="60" y="415">4) Store token (cookie) and redirect</text>
  <line class="arrow" x1="390" y1="420" x2="330" y2="420"/>
  <rect class="note" x="410" y="390" width="280" height="60"/>
  <text class="small" x="420" y="415">401 on invalid; 200 on success</text>

  <!-- Profile fetch -->
  <rect class="box" x="50" y="480" width="280" height="60"/>
  <text class="small" x="60" y="505">5) Fetch /api/auth/me with Bearer</text>
  <line class="arrow" x1="330" y1="510" x2="390" y2="510"/>
  <rect class="note" x="410" y="480" width="280" height="60"/>
  <text class="small" x="420" y="505">protect - verify JWT - attach req.user</text>
  <line class="arrow" x1="690" y1="510" x2="750" y2="510"/>
  <rect class="note" x="770" y="480" width="280" height="60"/>
  <text class="small" x="780" y="505">findById(decoded.id), -password</text>
  
  <rect class="box" x="50" y="570" width="280" height="60"/>
  <text class="small" x="60" y="595">6) Profile data returned</text>
  <line class="arrow" x1="390" y1="600" x2="330" y2="600"/>

  <!-- Errors -->
  <rect class="error" x="50" y="650" width="280" height="70"/>
  <text class="small" x="60" y="675">Common Errors:</text>
  <text class="small" x="60" y="695">• 401 invalid credentials/token</text>
  <text class="small" x="60" y="715">• 400 duplicate email on register</text>
</svg>
